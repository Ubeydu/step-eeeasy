# Development Plan for 2025-10-29

## Current Status
- ✅ Phase 1 & 2 Complete: Home screen with timer + Settings with persistence
- ✅ Major Simplification: Removed GPS/Paths, simplified to stride-based tracking
- ✅ Database v2: Single WalkEntity table, no GPS tracking
- ✅ Navigation: Home, History, Settings (3 tabs)

## Recommended Next Step: Phase 3 - Sensor Integration

### Why Phase 3 Next?
1. **Makes the app actually useful** - Currently steps and distance show 0 (placeholders)
2. **Most impactful feature** - Users can start tracking real walks
3. **History will be meaningful** - Real data to display when implementing Phase 4
4. **Good learning opportunity** - Android sensors, foreground services, permissions

---

## Phase 3 Implementation Plan

### 1. Permissions (Start Here - Easiest)
**Goal:** Request runtime permissions for step counting

**Tasks:**
- Add permissions to AndroidManifest.xml:
  - `ACTIVITY_RECOGNITION` (for step counter)
  - `FOREGROUND_SERVICE`
  - `POST_NOTIFICATIONS` (API 33+)
- Implement permission request flow in HomeScreen
- Handle permission denied gracefully (show explanation)
- Test permission flow on device

**Files to Create/Modify:**
- `AndroidManifest.xml`
- `presentation/home/HomeScreen.kt` (add permission request)
- `presentation/home/HomeViewModel.kt` (handle permission state)

---

### 2. StrideCalculator Utility (Simple Math)
**Goal:** Calculate distance from steps and user height

**Formula:**
```kotlin
stride_length_meters = height_cm × 0.43 / 100.0
distance_km = (steps × stride_length_meters) / 1000.0
```

**Tasks:**
- Create `util/StrideCalculator.kt`
- Add unit tests for calculation accuracy
- Integrate with HomeViewModel

**Files to Create:**
- `app/src/main/java/com/example/stepeeeasy/util/StrideCalculator.kt`
- `app/src/test/java/com/example/stepeeeasy/util/StrideCalculatorTest.kt`

---

### 3. SensorManager (Step Counter Integration)
**Goal:** Read steps from device's built-in step counter sensor

**Key Concepts:**
- Use `Sensor.TYPE_STEP_COUNTER` (not accelerometer)
- Record baseline when walk starts
- Calculate delta: `current_steps - baseline_steps`
- Update UI every second (throttle sensor events)

**Tasks:**
- Create `service/SensorManager.kt`
- Register sensor listener when walk starts
- Track baseline offset
- Expose step count via callback/Flow
- Unregister listener when walk stops

**Files to Create:**
- `app/src/main/java/com/example/stepeeeasy/service/SensorManager.kt`

---

### 4. WalkTrackingService (Background Tracking)
**Goal:** Foreground service to keep tracking even when app is minimized

**Key Concepts:**
- Foreground service with persistent notification
- Orchestrates SensorManager
- Updates notification with live step count
- Handles START/STOP intents
- Periodically updates WalkEntity in database

**Tasks:**
- Create `service/WalkTrackingService.kt`
- Add service to AndroidManifest
- Create notification channel
- Implement START_WALK and STOP_WALK actions
- Update active walk in database every 5 seconds

**Files to Create:**
- `app/src/main/java/com/example/stepeeeasy/service/WalkTrackingService.kt`
- Update `AndroidManifest.xml` (add service declaration)

---

### 5. Update HomeViewModel & UI
**Goal:** Display real step count and calculated distance

**Tasks:**
- Start/stop WalkTrackingService from HomeViewModel
- Observe active walk from repository (already has Flow)
- Calculate distance using StrideCalculator + user height from Settings
- Display real-time steps and distance on HomeScreen
- Save final values when walk stops

**Files to Modify:**
- `presentation/home/HomeViewModel.kt`
- `presentation/home/HomeScreen.kt` (already has UI, just update data)

---

## Implementation Order

**Day 1:**
1. Permissions (AndroidManifest + runtime request)
2. StrideCalculator utility + tests

**Day 2:**
3. SensorManager (step counter integration)
4. Test on real device (emulator has limited sensor support)

**Day 3:**
5. WalkTrackingService (foreground service)
6. Integrate service with HomeViewModel

**Day 4:**
7. End-to-end testing (walk around, minimize app, verify tracking)
8. Fix bugs, polish notification

---

## Testing Strategy

### Unit Tests
- StrideCalculator: Verify formula accuracy
- HomeViewModel: Verify service start/stop logic

### Instrumented Tests (Requires Device)
- Permission request flow
- Sensor availability check
- Service lifecycle (start, stop, notification)

### Manual Testing (Real Device Required)
- Grant permissions
- Start walk, see steps counting
- Minimize app, verify notification shows live steps
- Return to app, verify timer + steps accurate
- Stop walk, verify data saved to database

---

## Alternative: Phase 4 - History Screen

If you prefer UI work over sensors, you could implement History screen first:

**Pros:**
- Simpler (just UI + database queries)
- No permissions or sensors needed
- Visually complete feature

**Cons:**
- Will show walks with 0 steps until Phase 3 is done
- Less rewarding to test without real data

**Phase 4 Tasks:**
- Create `domain/usecase/GetAllWalksUseCase.kt`
- Create `presentation/history/HistoryViewModel.kt`
- Create `presentation/history/HistoryScreen.kt` (LazyColumn list)
- Format: Walk ID (#1, #2...), distance, steps, day + date
- Simple list, no charts

---

## Recommendation

**Start with Phase 3** - More impactful, and you'll have real walk data to make History screen more satisfying to build!

Begin with permissions and StrideCalculator (easiest parts), then work up to sensors and service.

---

## Resources

- **Sensor Documentation:** https://developer.android.com/develop/sensors-and-location/sensors/sensors_motion#sensors-motion-stepcounter
- **Foreground Services:** https://developer.android.com/develop/background-work/services/foreground-services
- **Runtime Permissions:** https://developer.android.com/training/permissions/requesting
- **Simplified Plan:** `docs/android-development-plan-simplified.md`
